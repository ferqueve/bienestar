<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bienestar Floral</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- SweetAlert2 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.8.0/dist/sweetalert2.min.css"
    />
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

    <style>
      :root {
        --primary-pink: #ec4899;
        --light-pink: #fce7f3;
        --pale-pink: #fdf2f8;
        --dark-pink: #be185d;
        --soft-pink: #f9a8d4;
      }

      body {
        background: linear-gradient(
          135deg,
          var(--pale-pink) 0%,
          var(--light-pink) 100%
        );
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
      }

      .header-gradient {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(236, 72, 153, 0.1);
      }

      .hero-section {
        padding: 100px 0;
        background: linear-gradient(
          135deg,
          var(--pale-pink) 0%,
          rgba(236, 72, 153, 0.1) 100%
        );
      }

      .product-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: none;
      }

      .product-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(236, 72, 153, 0.2);
      }

      .product-image {
        height: 250px;
        overflow: hidden;
        position: relative;
      }

      .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .product-card:hover .product-image img {
        transform: scale(1.1);
      }

      .badge-category {
        background: var(--light-pink) !important;
        color: var(--primary-pink) !important;
        font-weight: 600;
      }

      .btn-pink {
        background: var(--primary-pink);
        border: none;
        color: white;
        font-weight: 600;
        padding: 10px 25px;
        border-radius: 25px;
        transition: all 0.3s ease;
      }

      .btn-pink:hover {
        background: var(--dark-pink);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(236, 72, 153, 0.4);
      }

      .cart-badge {
        background: var(--primary-pink);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        position: absolute;
        top: -8px;
        right: -8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .footer-bg {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
      }

      .modal-custom {
        backdrop-filter: blur(5px);
      }

      .modal-content {
        border: none;
        border-radius: 20px;
        overflow: hidden;
      }

      .loading-spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid var(--light-pink);
        border-radius: 50%;
        border-top-color: var(--primary-pink);
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .price-tag {
        color: var(--primary-pink);
        font-weight: 700;
        font-size: 1.5rem;
      }

      .quantity-controls {
        border: 2px solid var(--light-pink);
        border-radius: 25px;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
      }

      .quantity-btn {
        background: var(--light-pink);
        border: none;
        color: var(--primary-pink);
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .quantity-btn:hover {
        background: var(--primary-pink);
        color: white;
      }

      .quantity-display {
        padding: 0 15px;
        font-weight: 600;
        color: var(--dark-pink);
      }

      .social-link {
        color: var(--primary-pink);
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .social-link:hover {
        color: var(--dark-pink);
        text-decoration: none;
      }

      .section-title {
        color: var(--dark-pink);
        font-weight: 700;
        margin-bottom: 3rem;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg sticky-top header-gradient">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <i
            class="fas fa-spa text-pink me-2"
            style="color: var(--primary-pink); font-size: 1.8rem"
          ></i>
          <div>
            <div class="fw-bold" style="color: var(--dark-pink)">
              Bienestar Floral
            </div>
            <small style="color: var(--primary-pink)"
              >Claudia De Meis - Psicoterapeuta</small
            >
          </div>
        </a>
        <button class="btn position-relative" onclick="openCart()">
          <i
            class="fas fa-shopping-cart"
            style="color: var(--primary-pink); font-size: 1.5rem"
          ></i>
          <span class="cart-badge d-none" id="cartBadge">0</span>
        </button>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-center">
      <div class="container">
        <div data-aos="fade-up">
          <h1 class="display-4 fw-bold mb-4" style="color: var(--dark-pink)">
            Fórmula Magistral de Flores de Bach.
            <span class="d-block" style="color: var(--primary-pink)"></span>
          </h1>
          <p class="lead mb-4" style="color: var(--dark-pink)">
            <i class="fas fa-spa text-pink me-2"></i> Elaborados con amor y
            dedicación para acompañar tu bienestar emocional.<br />
            Cada gotero es preparado artesanalmente siguiendo los métodos
            tradicionales del Dr. Bach.
          </p>
        </div>
      </div>
    </section>

    <!-- Products Section -->
    <section class="py-5">
      <div class="container">
        <h2 class="text-center section-title" data-aos="fade-up">
          Nuestros Productos
        </h2>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center py-5">
          <div class="loading-spinner mx-auto mb-3"></div>
          <p style="color: var(--primary-pink)">Cargando productos...</p>
        </div>

        <!-- Products Grid -->
        <div id="productsGrid" class="row g-4 d-none">
          <!-- Products will be loaded here -->
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer-bg py-5 mt-5">
      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <div class="d-flex align-items-center mb-3">
              <i
                class="fas fa-spa me-2"
                style="color: var(--primary-pink); font-size: 1.5rem"
              ></i>
              <h5 class="mb-0" style="color: var(--dark-pink)">
                Flores de Bach
              </h5>
            </div>
            <p style="color: var(--dark-pink)">
              Goteros artesanales elaborados con amor y dedicación para tu
              bienestar emocional.
            </p>
          </div>
          <div class="col-md-4">
            <h5 class="mb-3" style="color: var(--dark-pink)">Contacto</h5>
            <p class="fw-bold mb-2" style="color: var(--dark-pink)">
              Claudia De Meis - Psicoterapeuta
            </p>
            <div class="mb-2">
              <i
                class="fab fa-instagram me-2"
                style="color: var(--primary-pink)"
              ></i>
              <a
                href="https://instagram.com/claudia.de.meis.psicoterapeuta"
                target="_blank"
                class="social-link"
              >
                @claudia.de.meis.psicoterapeuta
              </a>
            </div>
            <div>
              <a
                href="mailto:demeisclaudia@gmail.com?subject=Quiero%20m%C3%A1s%20informaci%C3%B3n&body=Quiero%20m%C3%A1s%20informaci%C3%B3n%20sobre%20los%20productos%20o%20consultas"
                target="_blank"
                class="social-link"
              >
                <i
                  class="fas fa-envelope me-2"
                  style="color: var(--primary-pink)"
                ></i>
                <span style="color: var(--dark-pink); font-style: italic"
                  >demeisclaudia@gmail.com</span
                >
              </a>
            </div>
            <div>
              <i
                class="fa-brands fa-whatsapp me-2"
                style="color: var(--primary-pink)"
              ></i>
              <span style="color: var(--dark-pink); font-style: italic"
                >+598 092 912 456</span
              >
            </div>
          </div>
          <div class="col-md-4">
            <h5 class="mb-3" style="color: var(--dark-pink)">Información</h5>
            <ul class="list-unstyled" style="color: var(--dark-pink)">
              <li class="mb-1">
                <i
                  class="fas fa-check me-2"
                  style="color: var(--primary-pink)"
                ></i
                >Productos artesanales
              </li>
              <li class="mb-1">
                <i
                  class="fas fa-check me-2"
                  style="color: var(--primary-pink)"
                ></i
                >Métodos tradicionales del Dr. Bach
              </li>
              <li class="mb-1">
                <i
                  class="fas fa-check me-2"
                  style="color: var(--primary-pink)"
                ></i
                >Consultas personalizadas
              </li>
              <li class="mb-1">
                <i
                  class="fas fa-check me-2"
                  style="color: var(--primary-pink)"
                ></i
                >Entrega en Uruguay
              </li>
            </ul>
          </div>
        </div>
        <hr style="border-color: var(--light-pink)" />
        <div class="text-center">
          <p class="mb-0" style="color: var(--dark-pink)">
            <i class="fas fa-heart me-1" style="color: var(--primary-pink)"></i>
            Hecho con amor para tu bienestar
          </p>
        </div>
      </div>
    </footer>

    <!-- Product Detail Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header border-0 position-relative p-0">
            <img
              id="modalImage"
              src=""
              alt=""
              class="w-100"
              style="height: 300px; object-fit: cover"
            />
            <button
              type="button"
              class="btn-close position-absolute top-0 end-0 m-3 bg-white rounded-circle p-2"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h3
                id="modalTitle"
                class="fw-bold"
                style="color: var(--dark-pink)"
              ></h3>
              <span id="modalCategory" class="badge badge-category"></span>
            </div>
            <p id="modalDescription" style="color: var(--dark-pink)"></p>
            <div class="mb-3">
              <h6 class="fw-bold" style="color: var(--dark-pink)">
                Ingredientes:
              </h6>
              <p id="modalIngredients" style="color: var(--dark-pink)"></p>
            </div>
            <div class="mb-4">
              <h6 class="fw-bold" style="color: var(--dark-pink)">
                Modo de uso:
              </h6>
              <p id="modalUsage" style="color: var(--dark-pink)"></p>
            </div>
            <div
              class="d-flex justify-content-between align-items-center border-top pt-3"
              id="modalButtonSection"
            >
              <span id="modalPrice" class="price-tag"></span>
              <button class="btn btn-pink" onclick="addToCartFromModal()">
                <i class="fas fa-plus me-2"></i>Agregar al carrito
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header" style="background: var(--light-pink)">
            <h5 class="modal-title fw-bold" style="color: var(--dark-pink)">
              <i class="fas fa-shopping-cart me-2"></i>Tu Carrito
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body" style="max-height: 400px; overflow-y: auto">
            <div id="cartItems">
              <!-- Cart items will be loaded here -->
            </div>
          </div>
          <div
            class="modal-footer border-0"
            style="background: var(--pale-pink)"
          >
            <div class="w-100">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h5 class="mb-0" style="color: var(--dark-pink)">Total:</h5>
                <h4 class="mb-0 price-tag" id="cartTotal">$0</h4>
              </div>
              <div class="d-grid gap-2">
                <!-- PayPal Button Container -->
                <div id="paypal-button-container" style="display: none"></div>
                <button
                  class="btn"
                  style="background: #0070ba; color: white"
                  onclick="payWithPayPal()"
                  id="paypal-btn-basic"
                >
                  <i class="fab fa-paypal me-2"></i>Pagar con PayPal
                </button>
                <!-- MercadoPago Button -->
                <button
                  class="btn"
                  style="background: #00b1ea; color: white"
                  onclick="payWithMercadoPago()"
                >
                  <i class="fas fa-credit-card me-2"></i>Pagar con MercadoPago
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.8.0/dist/sweetalert2.all.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AaURHUsuJaAQ4Jt_Cenr4dkDox7HYri8FyANn47ge6ZeK-c0ESlhY44WCRnjC-2AjCG5Piku7kLZLK_1&currency=USD&intent=capture"></script>

    <script>
      // Global variables
      let products = [];
      let cart = [];
      let currentProduct = null;

      // Sample products (replace with your GitHub JSON URL)
      const sampleProducts = [
        {
          id: 1,
          name: "Rescue Remedy",
          price: 850,
          description:
            "Mezcla de emergencia para momentos de crisis, estrés agudo o shock emocional. Combina Star of Bethlehem, Rock Rose, Impatiens, Cherry Plum y Clematis.",
          image: "/img/img1.png",
          category: "Emergencia",
          ingredients: [
            "Star of Bethlehem",
            "Rock Rose",
            "Impatiens",
            "Cherry Plum",
            "Clematis",
          ],
          usage:
            "4 gotas bajo la lengua o en agua, hasta 6 veces al día según necesidad.",
        },
        {
          id: 2,
          name: "Mimulus",
          price: 750,
          description:
            "Para miedos conocidos y específicos. Ayuda a enfrentar con valentía las situaciones que generan temor.",
          image: "../img/img2.png",
          category: "Miedos",
          ingredients: ["Mimulus"],
          usage:
            "2 gotas en agua, 4 veces al día o según indicación del terapeuta.",
        },
        {
          id: 3,
          name: "White Chestnut",
          price: 750,
          description:
            "Para pensamientos repetitivos e indeseados. Calma la mente y ayuda a encontrar paz mental.",
          image: "../img/img3.png",
          category: "Pensamientos",
          ingredients: ["White Chestnut"],
          usage: "2 gotas en agua o bajo la lengua, 3-4 veces al día.",
        },
        {
          id: 4,
          name: "Bach Flowers Blend Personalizado",
          price: 950,
          description:
            "Mezcla personalizada según tu consulta terapéutica. Incluye hasta 7 esencias específicas para tu proceso.",
          image: "../img/img5.png",
          category: "Personalizado",
          ingredients: ["Consultar según necesidad"],
          usage: "Según indicación personalizada en consulta.",
        },
        {
          id: 5,
          name: "Elm",
          price: 800,
          description:
            "Para momentos de agobio y sensación de no poder con las responsabilidades. Restaura la confianza en las propias capacidades.",
          image: "../img/img4.png",
          category: "Responsabilidad",
          ingredients: ["Elm"],
          usage: "2 gotas en agua, 4 veces al día durante períodos de estrés.",
        },
        {
          id: 6,
          name: "Walnut",
          price: 750,
          description:
            "Para períodos de transición y cambios importantes. Protege de influencias externas y ayuda a mantener el propio camino.",
          image: "../img/img6.png",
          category: "Transiciones",
          ingredients: ["Walnut"],
          usage: "2 gotas en agua, 3 veces al día durante procesos de cambio.",
        },
        {
          id: 7,
          name: "Test",
          price: 1,
          description: "Producto de prueba.",
          image: "../img/img1.png",
          category: "Prueba",
          ingredients: ["Walnut", "Elm"],
          usage: "2 gotas en agua, 3 veces al día durante procesos de cambio.",
        },
      ];

      // Initialize AOS animations
      AOS.init({
        duration: 800,
        once: true,
      });

      // Load products on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadProducts();
      });

      // Load products function
      async function loadProducts() {
        try {
          // TODO: Replace with your GitHub JSON URL
          // const response = await fetch('https://raw.githubusercontent.com/your-username/your-repo/main/productos.json');
          // const data = await response.json();

          // Using sample data for demonstration
          setTimeout(() => {
            products = sampleProducts;
            displayProducts();
            document.getElementById("loadingSpinner").classList.add("d-none");
            document.getElementById("productsGrid").classList.remove("d-none");
          }, 1000);
        } catch (error) {
          console.error("Error loading products:", error);
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "No se pudieron cargar los productos. Por favor, intenta nuevamente.",
            confirmButtonColor: "#ec4899",
          });
        }
      }

      // Display products in grid
      function displayProducts() {
        const grid = document.getElementById("productsGrid");
        grid.innerHTML = "";

        products.forEach((product, index) => {
          const productCard = `
                    <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="${
                      index * 100
                    }">
                        <div class="product-card" onclick="showProductDetail(${
                          product.id
                        })">
                            <div class="product-image">
                                <img src="${product.image}" alt="${
            product.name
          }">
                            </div>
                            <div class="p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="fw-bold mb-0" style="color: var(--dark-pink);">${
                                      product.name
                                    }</h5>
                                    <span class="badge badge-category">${
                                      product.category
                                    }</span>
                                </div>
                                <p class="text-muted mb-3" style="font-size: 0.9rem;">${product.description.substring(
                                  0,
                                  100
                                )}...</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="price-tag">$${
                                      product.price
                                    }</span>
                                    <button class="btn btn-pink" onclick="event.stopPropagation(); addToCart(${
                                      product.id
                                    })">
                                        <i class="fas fa-plus me-2"></i>Agregar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
          grid.innerHTML += productCard;
        });
      }

      // Show product detail modal
      // Reemplaza tu función showProductDetail con esta versión corregida:

function showProductDetail(productId) {
    currentProduct = products.find((p) => p.id === productId);
    if (!currentProduct) return;

    // PRIMERO: Establecer todos los valores de texto
    document.getElementById("modalImage").src = currentProduct.image;
    document.getElementById("modalTitle").textContent = currentProduct.name;
    document.getElementById("modalCategory").textContent = currentProduct.category;
    document.getElementById("modalDescription").textContent = currentProduct.description;
    document.getElementById("modalIngredients").textContent = currentProduct.ingredients.join(", ");
    document.getElementById("modalUsage").textContent = currentProduct.usage;

    // DESPUÉS: Modificar el HTML del botón (esto incluye el precio)
    const modalButtonSection = document.getElementById("modalButtonSection");
    
    if (currentProduct.id === 4) {
        // Producto personalizado - Mostrar botón de WhatsApp
        modalButtonSection.innerHTML = `
            <span class="price-tag">$${currentProduct.price}</span>
            <button class="btn btn-success" onclick="showConsultationModal()">
                <i class="fab fa-whatsapp me-2"></i>Consultar por WhatsApp
            </button>
        `;
    } else {
        // Productos normales - Mostrar botón normal
        modalButtonSection.innerHTML = `
            <span class="price-tag">$${currentProduct.price}</span>
            <button class="btn btn-pink" onclick="addToCartFromModal()">
                <i class="fas fa-plus me-2"></i>Agregar al carrito
            </button>
        `;
    }

    // FINALMENTE: Mostrar el modal
    new bootstrap.Modal(document.getElementById("productModal")).show();
}
      // Add to cart from modal
      function addToCartFromModal() {
        if (currentProduct) {
          addToCart(currentProduct.id);
          bootstrap.Modal.getInstance(
            document.getElementById("productModal")
          ).hide();
        }
      }

      // Add to cart function
      function addToCart(productId) {
        const product = products.find((p) => p.id === productId);
        if (!product) return;

        const existingItem = cart.find((item) => item.id === productId);
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ ...product, quantity: 1 });
        }

        updateCartUI();

        Swal.fire({
          icon: "success",
          title: "¡Agregado!",
          text: `${product.name} agregado al carrito`,
          timer: 1500,
          showConfirmButton: false,
          confirmButtonColor: "#ec4899",
        });
      }

      // Update cart UI
      function updateCartUI() {
        const totalItems = cart.reduce(
          (total, item) => total + item.quantity,
          0
        );
        const badge = document.getElementById("cartBadge");

        if (totalItems > 0) {
          badge.textContent = totalItems;
          badge.classList.remove("d-none");
        } else {
          badge.classList.add("d-none");
        }
      }

      // Open cart modal
      function openCart() {
        updateCartDisplay();
        new bootstrap.Modal(document.getElementById("cartModal")).show();
      }

      // Update cart display in modal
      function updateCartDisplay() {
        const cartItems = document.getElementById("cartItems");
        const cartTotal = document.getElementById("cartTotal");

        // Reset PayPal button when cart changes
        resetPayPalButton();

        if (cart.length === 0) {
          cartItems.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: var(--light-pink);"></i>
                        <p class="mt-3 text-muted">Tu carrito está vacío</p>
                    </div>
                `;
          cartTotal.textContent = "$0";
          return;
        }

        let cartHTML = "";
        let total = 0;

        cart.forEach((item) => {
          const subtotal = item.price * item.quantity;
          total += subtotal;

          cartHTML += `
                    <div class="d-flex align-items-center mb-3 p-3 border rounded">
                        <img src="${item.image}" alt="${item.name}" 
                             style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-1" style="color: var(--dark-pink);">${
                              item.name
                            }</h6>
                            <p class="mb-0 price-tag">$${item.price}</p>
                        </div>
                        <div class="quantity-controls me-2">
                            <button class="quantity-btn" onclick="updateQuantity(${
                              item.id
                            }, ${item.quantity - 1})">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="quantity-display">${
                              item.quantity
                            }</span>
                            <button class="quantity-btn" onclick="updateQuantity(${
                              item.id
                            }, ${item.quantity + 1})">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeFromCart(${
                          item.id
                        })">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
        });

        cartItems.innerHTML = cartHTML;
        cartTotal.textContent = "$" + total;
      }

      // Update quantity in cart
      function updateQuantity(productId, newQuantity) {
        if (newQuantity <= 0) {
          removeFromCart(productId);
          return;
        }

        const item = cart.find((item) => item.id === productId);
        if (item) {
          item.quantity = newQuantity;
          updateCartUI();
          updateCartDisplay();
        }
      }

      // Remove from cart
      function removeFromCart(productId) {
        cart = cart.filter((item) => item.id !== productId);
        updateCartUI();
        updateCartDisplay();
      }

      // PayPal payment
      function payWithPayPal() {
        if (cart.length === 0) {
          Swal.fire({
            icon: "warning",
            title: "Carrito vacío",
            text: "Agrega productos antes de proceder al pago",
            confirmButtonColor: "#ec4899",
          });
          return;
        }

        // Mostrar el botón PayPal integrado
        showPayPalButton();
      }

      function showPayPalButton() {
        // Ocultar botón básico y mostrar PayPal integrado
        document.getElementById("paypal-btn-basic").style.display = "none";
        document.getElementById("paypal-button-container").style.display =
          "block";

        // Limpiar contenedor
        document.getElementById("paypal-button-container").innerHTML = "";

        // SOLUCIÓN: Calcular precios en USD manteniendo consistencia
        const exchangeRate = 40; // 1 USD ≈ 40 UYU

        // Primero convertir cada item individualmente y redondear
        const itemsUSD = cart.map((item) => {
          const unitPriceUSD = parseFloat(
            (item.price / exchangeRate).toFixed(2)
          );
          return {
            ...item,
            unitPriceUSD: unitPriceUSD,
            subtotalUSD: parseFloat((unitPriceUSD * item.quantity).toFixed(2)),
          };
        });

        // El total debe ser la suma de los subtotales ya redondeados
        const totalUSD = itemsUSD
          .reduce((sum, item) => sum + item.subtotalUSD, 0)
          .toFixed(2);

        // Crear items para PayPal usando los precios ya calculados
        const items = itemsUSD.map((item) => ({
          name: item.name,
          unit_amount: {
            currency_code: "USD",
            value: item.unitPriceUSD.toFixed(2),
          },
          quantity: item.quantity.toString(),
          description: item.category,
          category: "PHYSICAL_GOODS",
        }));

        console.log("Items USD:", itemsUSD);
        console.log("Total calculado:", totalUSD);
        console.log(
          "Verificación:",
          itemsUSD.reduce((sum, item) => sum + item.subtotalUSD, 0)
        );

        // Crear botón PayPal integrado
        paypal
          .Buttons({
            style: {
              color: "blue",
              shape: "rect",
              label: "pay",
              height: 45,
            },
            createOrder: function (data, actions) {
              return actions.order.create({
                purchase_units: [
                  {
                    reference_id: "flores-bach-" + Date.now(),
                    description: "Goteros Flores de Bach - Claudia De Meis",
                    amount: {
                      currency_code: "USD",
                      value: totalUSD,
                      breakdown: {
                        item_total: {
                          currency_code: "USD",
                          value: totalUSD,
                        },
                      },
                    },
                    items: items,
                  },
                ],
                application_context: {
                  brand_name: "Flores de Bach - Claudia De Meis",
                  landing_page: "LOGIN",
                  user_action: "PAY_NOW",
                  shipping_preference: "NO_SHIPPING",
                },
              });
            },
            onApprove: function (data, actions) {
              return actions.order.capture().then(function (orderData) {
                // Pago exitoso
                Swal.fire({
                  icon: "success",
                  title: "¡Pago exitoso!",
                  html: `Gracias por tu compra.<br>
                           <b>ID:</b> ${orderData.id}<br>
                           Te contactaremos por Instagram para la entrega.`,
                  confirmButtonColor: "#ec4899",
                  confirmButtonText: "Perfecto",
                }).then(() => {
                  // Limpiar carrito
                  cart = [];
                  updateCartUI();
                  updateCartDisplay();
                  // Cerrar modal
                  bootstrap.Modal.getInstance(
                    document.getElementById("cartModal")
                  ).hide();
                });
              });
            },
            onError: function (err) {
              console.error("PayPal Error:", err);
              Swal.fire({
                icon: "error",
                title: "Error en el pago",
                text: "Hubo un problema. Intenta nuevamente.",
                confirmButtonColor: "#ec4899",
              });
              resetPayPalButton();
            },
            onCancel: function () {
              resetPayPalButton();
            },
          })
          .render("#paypal-button-container");
      }
      function resetPayPalButton() {
        document.getElementById("paypal-btn-basic").style.display = "block";
        document.getElementById("paypal-button-container").style.display =
          "none";
      }

      // MercadoPago payment
      function payWithMercadoPago() {
        if (cart.length === 0) {
          Swal.fire({
            icon: "warning",
            title: "Carrito vacío",
            text: "Agrega productos antes de proceder al pago",
            confirmButtonColor: "#ec4899",
          });
          return;
        }

        // Para implementación completa de MercadoPago necesitas un backend
        Swal.fire({
          icon: "info",
          title: "MercadoPago",
          html: "<strong>El pago por este medio aún no está habilitado </strong>",
          confirmButtonColor: "#ec4899",
          confirmButtonText: "Entendido",
        });
      }
  // AGREGAR TODAS ESTAS FUNCIONES AL FINAL DE TU SCRIPT

// Lista de emociones/síntomas que el paciente puede seleccionar
const emotionsList = [
    "Sentimiento de derrota",
    "Desinterés", 
    "Falta de confianza en uno mismo",
    "Dependencia de la opinión de los demás",
    "Anclamiento en situaciones del pasado",
    "Sentimiento de tristeza sin motivo",
    "Preocupación excesiva por los del círculo más próximo",
    "Depresión, ataques de pánico",
    "Buscar flexibilidad mental",
    "Paliar un estado de shock o conmoción reciente (pérdidas físicas, separaciones de pareja, enfermedades)",
    "Exceso de entusiasmo",
    "Protegerse de influencias externas",
    "Luchar contra los pensamientos no deseados",
    "Resignación",
    "Miedo o ansiedad de origen desconocido",
    "Desamor",
    "Miedo a perder el control y la histeria",
    "Amor posesivo",
    "Celos, envidia, ansias de venganza",
    "Sentimiento de culpabilidad",
    "Desánimo",
    "Impaciencia",
    "Insomnio",
    "Gula (apetito desmedido)",
    "Agobio por carga de responsabilidades",
    "Búsqueda de paz mental y física"
];

// REEMPLAZAR la función showConsultationModal existente
function showConsultationModal() {
    const modalHTML = `
        <div class="modal fade" id="consultationModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header" style="background: var(--light-pink);">
                        <h5 class="modal-title fw-bold" style="color: var(--dark-pink);">
                            <i class="fas fa-spa me-2"></i>Consulta Personalizada - Flores de Bach
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <h6 class="fw-bold mb-2">¿Cómo funciona?</h6>
                            <p class="mb-1">1. Revisa la lista de emociones y estados emocionales</p>
                            <p class="mb-1">2. Selecciona aquellas con las que te identifiques actualmente</p>
                            <p class="mb-0">3. Claudia evaluará tu consulta y recomendará las flores apropiadas</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="fw-bold" style="color: var(--dark-pink);">
                                Selecciona las emociones que resuenan contigo en este momento:
                            </h6>
                            <small class="text-muted mb-3 d-block">
                                Puedes seleccionar todas las que sientas que te representan actualmente
                            </small>
                            <div class="row g-2" id="emotionsCheckboxes">
                                <!-- Las emociones se cargarán aquí -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0" style="background: var(--pale-pink);">
                        <div class="w-100">
                            <div class="d-grid gap-2">
                                <button class="btn btn-success" onclick="sendEmotionalConsultation()">
                                    <i class="fab fa-whatsapp me-2"></i>Enviar consulta a Claudia
                                </button>
                                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

    if (!document.getElementById('consultationModal')) {
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    const container = document.getElementById('emotionsCheckboxes');
    container.innerHTML = '';
    
    emotionsList.forEach((emotion, emotionIndex) => {
        const emotionDiv = `
            <div class="col-12">
                <div class="form-check p-3 border rounded hover-effect" style="cursor: pointer;">
                    <input class="form-check-input" type="checkbox" value="${emotion}" id="emotion${emotionIndex}">
                    <label class="form-check-label w-100" for="emotion${emotionIndex}" style="cursor: pointer;">
                        <div class="fw-bold" style="color: var(--dark-pink);">${emotion}</div>
                    </label>
                </div>
            </div>
        `;
        container.innerHTML += emotionDiv;
    });

    new bootstrap.Modal(document.getElementById('consultationModal')).show();
}

// Nueva función para enviar consulta emocional
function sendEmotionalConsultation() {
    const checkboxes = document.querySelectorAll('#emotionsCheckboxes input[type="checkbox"]:checked');
    const selectedEmotions = Array.from(checkboxes).map(cb => cb.value);
    
    if (selectedEmotions.length === 0) {
        Swal.fire({
            icon: 'warning',
            title: 'Selecciona al menos una emoción',
            text: 'Por favor, marca las emociones con las que te identificas actualmente',
            confirmButtonColor: '#ec4899'
        });
        return;
    }

    const phoneNumber = '5493456498896';
    const message = `Hola Claudia! 

Quiero solicitar una consulta para una mezcla personalizada de Flores de Bach.

*Estados emocionales con los que me identifico actualmente:*

${selectedEmotions.map(emotion => `• ${emotion}`).join('\n')}

*Total de emociones seleccionadas:* ${selectedEmotions.length}

¿Podrías evaluar mi situación y recomendarme las flores más apropiadas para mi proceso? También me gustaría información sobre dosis, precio y tiempo de preparación.

¡Gracias por tu ayuda profesional!`;

    // Cerrar modal primero
    bootstrap.Modal.getInstance(document.getElementById('consultationModal')).hide();

    // Detectar si estamos en un WebView o app nativa
    const isInApp = detectInAppBrowser();
    
    if (isInApp) {
        showManualWhatsAppInstructions(message, phoneNumber, selectedEmotions.length, 'emociones');
    } else {
        tryOpenWhatsApp(message, phoneNumber, selectedEmotions.length, 'emociones');
    }
}

// Detectar si estamos en un navegador integrado de app
function detectInAppBrowser() {
    const ua = navigator.userAgent || navigator.vendor || window.opera;
    
    const inAppPatterns = [
        /FBAN|FBAV/i,           // Facebook
        /Instagram/i,           // Instagram  
        /TwitterAndroid|Twitter for iPhone/i, // Twitter
        /LinkedInApp/i,         // LinkedIn
        /TikTok/i,              // TikTok
        /Line/i,                // Line
        /WeChat/i,              // WeChat
        /MicroMessenger/i,      // WeChat
        /telegram/i,            // Telegram
        /GSA/i,                 // Google App
        /DuckDuckGo/i          // DuckDuckGo App
    ];
    
    return inAppPatterns.some(pattern => pattern.test(ua));
}

// Intentar abrir WhatsApp con fallback
function tryOpenWhatsApp(message, phoneNumber, count, type = 'emociones') {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const countText = type === 'emociones' ? 'emociones seleccionadas' : 'flores seleccionadas';
    
    let whatsappURL;
    if (isMobile) {
        whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
    } else {
        whatsappURL = `https://web.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}`;
    }
    
    try {
        const newWindow = window.open(whatsappURL, '_blank', 'noopener,noreferrer');
        
        setTimeout(() => {
            if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                showManualWhatsAppInstructions(message, phoneNumber, count, type);
            } else {
                Swal.fire({
                    icon: 'success',
                    title: '¡Consulta enviada!',
                    html: `Se abrió ${isMobile ? 'WhatsApp' : 'WhatsApp Web'} con tu consulta.<br>
                           <strong>${count} ${countText}</strong><br>
                           Claudia evaluará tu situación y te responderá pronto.`,
                    confirmButtonColor: '#ec4899'
                });
            }
        }, 1000);
        
    } catch (error) {
        console.log('Error al abrir WhatsApp:', error);
        showManualWhatsAppInstructions(message, phoneNumber, count, type);
    }
}

// Mostrar instrucciones manuales si no se puede abrir automáticamente
function showManualWhatsAppInstructions(message, phoneNumber, count, type = 'emociones') {
    const countText = type === 'emociones' ? 'emociones seleccionadas' : 'flores seleccionadas';
    
    Swal.fire({
        icon: 'info',
        title: 'Envía tu consulta a Claudia por WhatsApp',
        html: `
            <div style="text-align: left;">
                <p><strong>📱 Opción 1:</strong> Abre WhatsApp y envía este mensaje a:</p>
                <div style="background: #e8f5e8; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center;">
                    <strong>+${phoneNumber}</strong>
                </div>
                
                <p><strong>💬 Mensaje:</strong></p>
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; font-size: 0.9rem; max-height: 200px; overflow-y: auto;">${message}</div>
                
                <div style="text-align: center; margin: 15px 0;">
                    <button class="btn btn-success me-2" onclick="copyMessageToClipboard('${message.replace(/'/g, "\\'")}')">
                        <i class="fas fa-copy me-2"></i>Copiar mensaje
                    </button>
                    <button class="btn btn-outline-success" onclick="copyPhoneToClipboard('${phoneNumber}')">
                        <i class="fas fa-phone me-2"></i>Copiar teléfono
                    </button>
                </div>
                
                <hr>
                <p><strong>📲 Opción 2:</strong> Usa estos enlaces directos:</p>
                <div style="text-align: center;">
                    <a href="https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}" target="_blank" class="btn btn-success btn-sm me-2">
                        <i class="fab fa-whatsapp me-2"></i>Abrir WhatsApp App
                    </a>
                    <a href="https://web.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}" target="_blank" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-desktop me-2"></i>WhatsApp Web
                    </a>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: #e8f4f8; border-radius: 8px; font-size: 0.9rem;">
                    <strong>✨ ${count} ${countText}</strong><br>
                    Claudia evaluará tu consulta y te recomendará las flores más apropiadas para tu proceso emocional.
                </div>
            </div>
        `,
        showConfirmButton: true,
        confirmButtonText: 'Entendido',
        confirmButtonColor: '#ec4899',
        width: '600px',
        customClass: {
            htmlContainer: 'text-start'
        }
    });
}

// Función para copiar mensaje
function copyMessageToClipboard(text) {
    copyToClipboard(text, 'Mensaje copiado al portapapeles');
}

// Función para copiar teléfono
function copyPhoneToClipboard(phone) {
    copyToClipboard(`+${phone}`, 'Teléfono copiado al portapapeles');
}

// Función universal para copiar al portapapeles
function copyToClipboard(text, successMessage) {
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
            showCopySuccess(successMessage);
        }).catch(err => {
            console.error('Error al copiar:', err);
            fallbackCopyTextToClipboard(text, successMessage);
        });
    } else {
        fallbackCopyTextToClipboard(text, successMessage);
    }
}

// Método alternativo para copiar
function fallbackCopyTextToClipboard(text, successMessage) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        document.execCommand('copy');
        showCopySuccess(successMessage);
    } catch (err) {
        console.error('Error al copiar:', err);
        Swal.fire({
            icon: 'warning',
            title: 'No se pudo copiar automáticamente',
            text: 'Por favor, selecciona y copia el texto manualmente',
            confirmButtonColor: '#ec4899',
            timer: 3000
        });
    }
    
    document.body.removeChild(textArea);
}

// Mostrar confirmación de copiado
function showCopySuccess(message) {
    Swal.fire({
        icon: 'success',
        title: '¡Copiado!',
        text: message,
        timer: 1500,
        showConfirmButton: false,
        toast: true,
        position: 'top-end'
    });
}
    </script>
  </body>
</html>
